# 아이템 23. 태그 달린 클래스보다는 클래스 계층구조를 활용하라

두 가지 이상의 의미를 표현할 수 있고 현재 표현하는 의미를 태그 값으로 알려주는 클래스를 본 적이 있을텐데

클래스 계층 구조를 활용하는 것이 더 낫다



<br>

## 태그 달린 클래스 단점



1. 쓸데 없는 코드가 많다
   - 열거 타입 선언, 태그 필드, switch문 등 쓸데없는 코드가 많다.
2. 가독성이 나쁘다
   - 여러 구현이 한 클래스에 혼합돼 있어서 가독성이 나쁘다.
3. 메모리를 많이 사용한다.
   - 다른 의미를 위한 코드를 함께 사용하니 메모리를 더 쓰게 됨

4. 필드들을 final로 선언시 해당 의미에 쓰이지 않는 필드들까지 생성자에서 초기화해야 한다.
   - 불 필요한 코드가 늘어남
   - 엉뚱한 필드를 초기화해도 런타임에 문제가 드러남

5. 런타임에 문제가 드러남
   - 새 의미를 추가할 때마다 모든 switch문을 찾아 새 의미를 처리하는 코드를 추가해야 하는데, 하나라도 빠뜨리면 런타임에 문제가 드러남
6. 인스턴스 타입만으로는 클래스가 현재 나타내는 의미를 알 길이 없다

<br>

컴파일러의 도움을 적게 받고 런타임 때 문제가 드러날 수 있는 큰 단점이 생긴다.

**태그 달린 클래스는 클래스 계층구조의 어설픈 아류작이며 장황하고, 오류를 내기 쉽고, 비효율적이다.**



<br>

## 클래스 계층구조

클래스 계층 구조를 활용하면 유연성과 컴파일타임 타입 검사 능력이 높아진다.

- 타입 사이의 자연스러운 계층 관계를 반영할 수 있음



### 태그 달린 클래스를 클래스 계층 구조로 바꾸는 방법

1. 태그 값에 따라 동작이 달라지는 메서드들을 루트 클래스의 추상 메서드로 선언한다
2. 태그 값에 상관없이 동작이 일정한 메서드들을 루트 클래스에 일반 메서드로 추가한다
3. 모든 하위 클래스에서 공통으로 사용하는 데이터 필드들도 전부 루트 클래스로 올린다.
4. 루트 클래스를 확장한 구체 클래스를 의미별로 하나씩 정의한다.





## 결론

1. 태그 달린 클래스를 써야하는 상황은 거의 없다.
2. 만약 새로운 클래스 작성시 태그 필드가 등장한다면 계층구조로 대체하는 방법을 생각해보자
3. 기존 클래스가 태그 필드를 사용하고 있으면 계층구조로 리팩토링하는 것을 검토해보자

